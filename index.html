<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª PDF Ùˆ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©/Ø¥ÙŠØ¯Ø§Ø¹ â€” Ù†Ø³Ø®Ø© Ù…Ø¯Ù…Ø¬Ø©</title>
<style>
body { font-family:"Segoe UI", Tahoma, sans-serif; direction:rtl; text-align:center; background:#f5f5f5; padding:18px 0 ;margin: 0; }
h2 { margin: 8px 0 18px; }
.box, .box3 { background:#fff; padding:12px 0 ; border-radius:8px; box-shadow:0 3px 6px rgba(0,0,0,.08); margin:10px auto; width:99%;  }
input, button { padding:8px; margin:6px 6px 6px 0; border-radius:6px; border:1px solid #ccc; }
button { background:#0078d7; color:#fff; border:0; cursor:pointer; }
button.red:hover { background:#d9534f; }
.secondary:hover { background-color:#d9534f;  }
table { width:100%; margin:18px auto; border-collapse:collapse; background:#fff; }
th, td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background:#0078d7; color:#fff; }
.action-btn { padding:4px 6px; margin:0 3px; border-radius:4px; border:0; cursor:pointer; }
.edit-btn, .editBtn { background:orange; color:#fff; }
.editBtn:hover { background:#009688; color:#fff; }
.edit-btn:hover { background:#009688; }
.delete-btn, .deleteBtn { background:orange; color:#fff; }
.delete-btn:hover, .deleteBtn:hover { background:red; }
tfoot td { background:#eee; font-weight:bold; }
.info { text-align:left; max-width:980px; margin:6px auto; color:#333; }
.small { font-size:0.9rem; color:#555; }

.form-row { display:flex; flex-wrap:nowrap; align-items:flex-end; justify-content:center; gap:10px; overflow-x:auto; }
.form-group { display:flex; flex-direction:column; min-width:120px; }
.form-group label { font-size:1.5rem; margin-bottom:4px; color:#333; }
.form-group input { font-size:1.2rem; padding:6px 8px; border-radius:6px; border:1px solid #ccc; width:175px; box-sizing:border-box; }
.form-row button { padding:8px 12px; border-radius:6px; border:none; background:#0078d7; color:#fff; cursor:pointer; font-size:17px; }
#updateBtn{ display:none; background:#F44336; color:#fff; height:38px; }
#updateBtn:hover{ background:#0078d7; }

@media (max-width: 768px) {
  .form-row { flex-wrap: wrap; justify-content: flex-start; }
  .form-group { flex:1 1 45%; min-width:auto; }
  .form-group input { width:100%; }
  .form-row button { flex:1 1 100%; margin-top:8px; }
}

/* Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© */
.box3 input { width:180px; font-size:17px; }
.box3 button { font-size:17px; }
tfoot #finalTotal { text-align:center; }
.editBox { margin-top:25px; padding:15px; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; display:none; font-size:17px; }

/* ØªØ¹Ø¯ÙŠÙ„: ØªÙˆØ­ÙŠØ¯ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª */
.full-width-container { width:99%; margin:10px auto; }
</style>
</head>
<body>

<h2> Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª PDFğŸ“„ </h2>
<div class="box">
  <form id="dataForm" onsubmit="return false;" class="form-row">
    <div class="form-group">
      <label for="date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
      <input type="text" id="date" placeholder="Ø§Ù„ÙŠÙˆÙ…-Ø§Ù„Ø´Ù‡Ø±-Ø§Ù„Ø³Ù†Ø©" maxlength="10">
    </div>
    <div class="form-group"><label for="tractor">Ø±Ù‚Ù… Ø§Ù„Ø¬Ø±Ø§Ø±</label><input type="text" id="tractor" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬Ø±Ø§Ø±" required></div>
    <div class="form-group"><label for="trailer">Ø±Ù‚Ù… Ø§Ù„Ù…Ù‚Ø·ÙˆØ±Ù‡</label><input type="text" id="trailer" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ù‚Ø·ÙˆØ±Ù‡" required></div>
    <div class="form-group"><label for="bon">Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆÙ†</label><input type="text" id="bon" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆÙ†" required></div>
    <div class="form-group"><label for="material">Ø§Ù„Ø®Ø§Ù…Ø©</label><input type="text" id="material" placeholder="Ø§Ù„Ø®Ø§Ù…Ø©" required></div>
    <div class="form-group"><label for="volume">Ø§Ù„ØªÙƒØ¹ÙŠØ¨</label><input type="number" id="volume" placeholder="Ø§Ù„ØªÙƒØ¹ÙŠØ¨" step="0.01" required></div>
    <div class="form-group"><label for="price">Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±</label><input type="number" id="price" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±" step="0.01" required></div>

    <button id="addBtn" onclick="onSubmitForm()">â• Ø¥Ø¶Ø§ÙØ©</button>
    <button id="updateBtn" onclick="onUpdateForm()">âœ… ØªØ¹Ø¯ÙŠÙ„</button>
  </form>
</div>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù PDF -->
<div class="box full-width-container">
  <div style="margin-bottom:8px;">
    <input type="file" id="pdfInput" accept="application/pdf" />
    <button onclick="readPDF()">ğŸ“¥ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù† PDF</button>
    <button class="secondary" onclick="clearFile()">âŒ Ù…Ø³Ø­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</button>
  </div>
  <div class="info small" id="parseInfo"></div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ PDF -->
<div class="full-width-container">
<table id="dataTable">
  <thead>
    <tr>
      <th>Ù…</th>
      <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ø±Ø§Ø±</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ù‚Ø·ÙˆØ±Ù‡</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆÙ†</th>
      <th>Ø§Ù„Ø®Ø§Ù…Ø©</th>
      <th>Ø§Ù„ØªÙƒØ¹ÙŠØ¨</th>
      <th>Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±</th>
      <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±</th>
      <th>Ø¹Ù…Ù„ÙŠØ§Øª</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="6">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
      <td id="totalVolume">0</td>
      <td>-</td>
      <td id="grandTotal">0</td>
      <td><button class="red" onclick="deleteAll()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¬Ù…ÙŠØ¹</button></td>
    </tr>
  </tfoot>
</table>
</div>


<div class="box3 full-width-container">
  <div>
    <input type="number" id="amountInput" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01">
    <input type="text" id="dateInput" placeholder="Ø§Ù„ÙŠÙˆÙ…-Ø§Ù„Ø´Ù‡Ø±-Ø§Ù„Ø³Ù†Ø©" maxlength="10">
    <button class="debtBtn" onclick="addDebtOrDeposit('debt')">â• Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</button>
    <button class="depositBtn" onclick="addDebtOrDeposit('deposit')">â• Ø¥ÙŠØ¯Ø§Ø¹</button>
  </div>

  <table id="debtDepositTable">
    <thead><tr><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø¹Ù…Ù„ÙŠØ§Øª</th></tr></thead>
    <tbody></tbody>
    <tfoot><tr><td style="text-align:center;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td id="finalTotal">0.00</td><td></td></tr></tfoot>
  </table>

  <div class="editBox" id="editBox">
    <h3 style="font-size:20px;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ</h3>
    <input type="number" id="editAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01">
    <input type="text" id="editDate" placeholder="Ø§Ù„ÙŠÙˆÙ…-Ø§Ù„Ø´Ù‡Ø±-Ø§Ù„Ø³Ù†Ø©" maxlength="10">
    <br>
    <button onclick="saveEdit()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    <button onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>
<div style="margin:12px auto; text-align:center;">
  <button onclick="printData()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button onclick="copyData()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button onclick="exportExcel()">ğŸ“Š Ø­ÙØ¸ ÙƒÙ€ Excel</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>

<script>
  /* === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© / Ø§Ù„Ù†Ø³Ø® / Excel Ø¨Ø¯ÙˆÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù === */
function cleanTableForExport(tableId){
  const clone = document.getElementById(tableId).cloneNode(true);
  clone.querySelectorAll("button").forEach(b=>b.remove());
  return clone;
}

function printData(){
  const tablePDF = cleanTableForExport("dataTable");
  const tableDebt = cleanTableForExport("debtDepositTable");
  const newWin = window.open("");
  newWin.document.write(`<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
  <style>
    body{font-family:"Segoe UI",Tahoma,sans-serif;direction:rtl;text-align:center;}
    table{width:100%;border-collapse:collapse;margin:20px 0;}
    th,td{border:1px solid #ddd;padding:8px;text-align:center;}
    th{background:#0078d7;color:#fff;}
  </style></head><body>
  <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª PDFğŸ“„</h2>${tablePDF.outerHTML}
  <h2>Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ÙˆØ§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</h2>${tableDebt.outerHTML}
  </body></html>`);
  newWin.document.close();
  newWin.print();
}

function copyData(){
  const tablePDF = cleanTableForExport("dataTable");
  const tableDebt = cleanTableForExport("debtDepositTable");
  const textToCopy = tablePDF.innerText + "\n\n" + tableDebt.innerText;
  navigator.clipboard.writeText(textToCopy).then(()=>alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…"));
}

function exportExcel(){
  const wb = XLSX.utils.book_new();
  const tablePDF = cleanTableForExport("dataTable");
  const ws1 = XLSX.utils.table_to_sheet(tablePDF);
  XLSX.utils.book_append_sheet(wb, ws1, "Ø¨ÙŠØ§Ù†Ø§Øª PDF");
  const tableDebt = cleanTableForExport("debtDepositTable");
  const ws2 = XLSX.utils.table_to_sheet(tableDebt);
  XLSX.utils.book_append_sheet(wb, ws2, "Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©/Ø¥ÙŠØ¯Ø§Ø¹");
  XLSX.writeFile(wb, "Ø¨ÙŠØ§Ù†Ø§Øª_PDF.xlsx");
}
/* === Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© === */
function padDate(input){ const parts=input.split('-'); if(parts.length!==3) return input; let [day, month, year]=parts; day=String(day).padStart(2,'0'); month=String(month).padStart(2,'0'); return `${day}-${month}-${year}`; }
function formatDate(input){ const parts=input.split('-'); if(parts.length!==3) return input; let [day, month, year]=parts; day=String(day).padStart(2,'0'); month=String(month).padStart(2,'0'); return `${year}-${month}-${day}`; }
function formatDateReverse(input){ const parts=input.split('-'); if(parts.length!==3) return input; let [year, month, day]=parts; day=String(day).padStart(2,'0'); month=String(month).padStart(2,'0'); return `${year}-${month}-${day}`; }

/* === Ø¨ÙŠØ§Ù†Ø§Øª PDF === */
let editRowIndex = null;
function parseNumberFromString(s){ if(!s) return NaN; const m=s.match(/-?\d[\d\.,]*/); if(!m) return NaN; return Number(m[0].replace(/,/g,'.')); }
function onSubmitForm(){ const dateRaw=document.getElementById("date").value; const date=formatDate(dateRaw); const tractor=document.getElementById("tractor").value.trim(); const trailer=document.getElementById("trailer").value.trim(); const bon=document.getElementById("bon").value.trim(); const material=document.getElementById("material").value.trim(); const volume=parseFloat(document.getElementById("volume").value); const price=parseFloat(document.getElementById("price").value); if(editRowIndex!==null){ updateRow(editRowIndex,date,tractor,trailer,bon,material,volume,price); editRowIndex=null; document.getElementById("dataForm").reset(); document.getElementById("addBtn").style.display="inline-block"; document.getElementById("updateBtn").style.display="none"; return; } addRow(date,tractor,trailer,bon,material,volume,price); document.getElementById("dataForm").reset(); }
function addRow(date,tractor,trailer,bon,material,volume,price){ if(!date||!tractor||!trailer||!bon||!material||isNaN(volume)||isNaN(price)){ alert("ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­."); return; } const tbody=document.querySelector("#dataTable tbody"); const tr=tbody.insertRow(); const total=(volume*price).toFixed(2); tr.innerHTML=`<td></td><td>${date}</td><td>${tractor}</td><td>${trailer}</td><td>${bon}</td><td>${material}</td><td>${volume}</td><td>${price}</td><td>${total}</td><td><button class="action-btn edit-btn" onclick="editRowFuncPDF(this)">âœï¸</button><button class="action-btn delete-btn" onclick="deleteRowPDF(this)">ğŸ—‘ï¸</button></td>`; updateIndexesPDF(); updateTotalsPDF(); }
function editRowFuncPDF(button){ const row=button.parentElement.parentElement; const tbody=document.querySelector("#dataTable tbody"); editRowIndex=Array.from(tbody.rows).indexOf(row); document.getElementById("date").value=row.cells[1].innerText; document.getElementById("tractor").value=row.cells[2].innerText; document.getElementById("trailer").value=row.cells[3].innerText; document.getElementById("bon").value=row.cells[4].innerText; document.getElementById("material").value=row.cells[5].innerText; document.getElementById("volume").value=row.cells[6].innerText; document.getElementById("price").value=row.cells[7].innerText; document.getElementById("addBtn").style.display="none"; document.getElementById("updateBtn").style.display="inline-block"; window.scrollTo({top:0,behavior:'smooth'}); }
function onUpdateForm(){ if(editRowIndex===null) return; const date=document.getElementById("date").value; const tractor=document.getElementById("tractor").value.trim(); const trailer=document.getElementById("trailer").value.trim(); const bon=document.getElementById("bon").value.trim(); const material=document.getElementById("material").value.trim(); const volume=parseFloat(document.getElementById("volume").value); const price=parseFloat(document.getElementById("price").value); updateRow(editRowIndex,date,tractor,trailer,bon,material,volume,price); document.getElementById("dataForm").reset(); document.getElementById("addBtn").style.display="inline-block"; document.getElementById("updateBtn").style.display="none"; editRowIndex=null; }
function updateRow(index,date,tractor,trailer,bon,material,volume,price){ const tbody=document.querySelector("#dataTable tbody"); const row=tbody.rows[index]; if(!row) return; const total=(volume*price).toFixed(2); row.cells[1].innerText=date; row.cells[2].innerText=tractor; row.cells[3].innerText=trailer; row.cells[4].innerText=bon; row.cells[5].innerText=material; row.cells[6].innerText=volume; row.cells[7].innerText=price; row.cells[8].innerText=total; updateTotalsPDF(); }
function deleteRowPDF(button){ button.parentElement.parentElement.remove(); updateIndexesPDF(); updateTotalsPDF(); }
function deleteAll(){ document.querySelector("#dataTable tbody").innerHTML=""; updateIndexesPDF(); updateTotalsPDF(); }
function updateIndexesPDF(){ const rows=document.querySelectorAll("#dataTable tbody tr"); rows.forEach((r,i)=>r.cells[0].innerText=i+1); }
function updateTotalsPDF(){ const rows=document.querySelectorAll("#dataTable tbody tr"); let totalVolume=0, grandTotal=0; rows.forEach(r=>{ totalVolume+=parseFloat(r.cells[6].innerText)||0; grandTotal+=parseFloat(r.cells[8].innerText)||0; }); document.getElementById("totalVolume").innerText=totalVolume.toFixed(2); document.getElementById("grandTotal").innerText=grandTotal.toFixed(2); updateFinalTotal(); }

/* === Ù‚Ø±Ø§Ø¡Ø© PDF === */
async function readPDF(){ const input=document.getElementById("pdfInput"); const file=input.files[0]; if(!file){ alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹"); return; } document.getElementById("parseInfo").innerText="Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ..."; const reader=new FileReader(); reader.onload=async function(){ const typed=new Uint8Array(this.result); const pdf=await pdfjsLib.getDocument(typed).promise; let added=0, skipped=0; for(let p=1;p<=pdf.numPages;p++){ const page=await pdf.getPage(p); const textContent=await page.getTextContent(); const items=textContent.items.map(it=>{ const t=it.transform||[1,0,0,1,0,0]; return { text:(it.str||"").trim(), x:t[4], y:t[5] }; }).filter(i=>i.text.length>0); if(items.length===0) continue; items.sort((a,b)=>{ if(Math.abs(b.y-a.y)>0.5) return b.y-a.y; return b.x-a.x; }); const rows=[]; const tolerance=4; items.forEach(it=>{ if(rows.length===0) rows.push({y:it.y, items:[it]}); else{ const last=rows[rows.length-1]; if(Math.abs(last.y-it.y)<=tolerance){ last.items.push(it); last.y=(last.y*(last.items.length-1)+it.y)/last.items.length; }else rows.push({y:it.y, items:[it]}); } }); rows.forEach(row=>row.items.sort((a,b)=>b.x-a.x)); for(const row of rows){ const texts=row.items.map(it=>it.text); if(texts.length<2){ skipped++; continue; } const nodes=texts.map(t=>({raw:t,num:parseNumberFromString(t)})); let idxTotal=-1, idxPrice=-1, idxVolume=-1; for(let k=nodes.length-1;k>=0;k--){ if(idxTotal===-1 && Number.isFinite(nodes[k].num)){ idxTotal=k; continue; } if(idxTotal!==-1 && idxPrice===-1 && Number.isFinite(nodes[k].num)){ idxPrice=k; continue; } if(idxPrice!==-1 && idxVolume===-1 && Number.isFinite(nodes[k].num)){ idxVolume=k; break; } } if(idxPrice===-1 || idxVolume===-1){ const numericIndices=nodes.map((n,i)=>Number.isFinite(n.num)?i:-1).filter(i=>i>=0); if(numericIndices.length>=2){ idxPrice=numericIndices[numericIndices.length-1]; idxVolume=numericIndices[numericIndices.length-2]; idxTotal=numericIndices[numericIndices.length-1]; }else{ skipped++; continue; } } const priceVal=nodes[idxPrice].num; const volumeVal=nodes[idxVolume].num; if(!Number.isFinite(priceVal)||!Number.isFinite(volumeVal)){ skipped++; continue; } const serial=nodes[0].raw; const date=nodes[1]?formatDateReverse(nodes[1].raw):""; const middle=nodes.slice(2, idxVolume); if(middle.length<3){ skipped++; continue; } const tractor=middle[0].raw||""; const trailer=middle[1]?middle[1].raw:""; const bon=middle[2]?middle[2].raw:""; const materialParts=middle.slice(3).map(n=>n.raw).filter(Boolean); const material=materialParts.join(" ")||(middle[2]&&middle[2].raw)||""; addRow(date, tractor, trailer, bon, material, volumeVal, priceVal); added++; } } document.getElementById("parseInfo").innerText=`ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ØªÙ… Ø¥Ø¶Ø§ÙØ© ${added} ØµÙ â€” ØªÙ… ØªØ¬Ø§Ù‡Ù„ ${skipped} Ø³Ø·Ø±.`; }; reader.readAsArrayBuffer(file); }
function clearFile(){ document.getElementById("pdfInput").value=""; document.getElementById("parseInfo").innerText=""; alert("ØªÙ… Ù…Ø³Ø­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù âœ…"); }

/* === Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© ÙˆØ¥ÙŠØ¯Ø§Ø¹ Ù…Ø­Ø³Ù‘Ù† === */
let editRow = null, editType='';
function addDebtOrDeposit(type){ const amountInput=document.getElementById("amountInput"); const dateInput=document.getElementById("dateInput"); let amount=parseFloat(amountInput.value); let date=dateInput.value.trim(); if(isNaN(amount)||!date){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!"); return; } date=padDate(date); const tbody=document.querySelector("#debtDepositTable tbody"); const tr=document.createElement("tr"); let details=type==='debt'?`Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ù„Øµ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨ØªØ§Ø±ÙŠØ® ${date}`:`Ø¯ÙØ¹Ù‡ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ Ø¨ØªØ§Ø±ÙŠØ® ${date}`; tr.innerHTML=`<td>${details}</td><td>${amount.toFixed(2)}</td><td><button class="editBtn" onclick="editRowFunc(this,'${type}')">âœï¸</button><button class="deleteBtn" onclick="deleteRowDebt(this)">ğŸ—‘ï¸</button></td>`; tbody.appendChild(tr); amountInput.value=''; dateInput.value=''; updateFinalTotal(); }
function updateFinalTotal(){ let totalDebt=0, totalDeposit=0; document.querySelectorAll("#debtDepositTable tbody tr").forEach(row=>{ const value=parseFloat(row.cells[1].innerText)||0; const detailsText=row.cells[0].innerText; if(detailsText.includes("Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©")) totalDebt+=value; else totalDeposit+=value; }); const grandTotal=parseFloat(document.getElementById("grandTotal").innerText)||0; document.getElementById("finalTotal").innerText=(grandTotal + totalDebt - totalDeposit).toFixed(2); }
function deleteRowDebt(button){ button.parentElement.parentElement.remove(); updateFinalTotal(); }
function editRowFunc(button,type){ editRow=button.parentElement.parentElement; editType=type; const amount=editRow.cells[1].innerText; const details=editRow.cells[0].innerText; let extractedDate=details.match(/\d{1,2}-\d{1,2}-\d{4}/); extractedDate=extractedDate?extractedDate[0]:''; document.getElementById("editAmount").value=amount; document.getElementById("editDate").value=extractedDate; document.getElementById("editBox").style.display='block'; }
function saveEdit(){ if(!editRow) return; let amount=parseFloat(document.getElementById("editAmount").value); let date=document.getElementById("editDate").value.trim(); if(isNaN(amount)||!date){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!"); return; } date=padDate(date); editRow.cells[1].innerText=amount.toFixed(2); let detailsText=editRow.cells[0].innerText; detailsText=detailsText.replace(/\d{2}-\d{2}-\d{4}/,date); editRow.cells[0].innerText=detailsText; updateFinalTotal(); cancelEdit(); }
function cancelEdit(){ editRow=null; editType=''; document.getElementById("editBox").style.display='none'; }
</script>

</body>
</html>
